Основные этапы загрузки хоста с ОС Linux:
![[msedge_ZojmbAUaYf.png]]
1. BIOS/UEFI  -> MBR/GPT
    
2. MBR/GPT -> Boot loader (GRUB2)
    
3. Boot loader (GRUB2) -> Инициализация ядра (Kernel)
    
4. Инициализация ядра (Kernel) -> Init (Systemd)

1) **BIOS** (basic input/output system) 
Первый шаг процесса загрузки не имеет ничего общего с Linux. Это аппаратная часть процесса загрузки, которая является одинаковой для любой операционной системы.

При включении питания запускается **BIOS**, которая запускает **POST** (Power-On Self-Test — «самотестирование при включении»), который является частью **BIOS**. В случае сбоя **BIOS** **POST**, компьютер нельзя будет использовать, поэтому процесс загрузки не продолжится.

- Ищет, загружает и выполняет программу-загрузчик ОС
- Как только загрузчик был обнаружен и загружен в память, BIOS передает управление ему.
**BIOS** определяет местонахождение главных загрузочных записей (**MBR**) на всех подключенных загрузочных устройствах. 
Короче говоря, **BIOS** загружает и выполняет загрузочную запись (**MBR**).


2) **MBR** (master boot record)
**MBR** — это главная загрузочная запись, хранящаяся на жестком диске
Она размещена в 1-м секторе загрузочного диска, например /dev/hda или /dev/sda
Она содержит информацию о **GRUB'е**
Простыми словами — **MBR** загружает и выполняет загрузчик **GRUB**

3) **GRUB** (Grand Unified Bootloader) / **GRUB2** (Grand Unified Bootloader version 2)
Это программа, которая делает компьютер достаточно умным, чтобы найти ядро ​​операционной системы (**Kernel**) и загрузить его в память.
- GRUB отображает заставку, и, подождав несколько секунд интерактивного воздействия пользователя, если он не нажал ни одной клавиши, он загружает ядро, установленное по умолчанию в файле конфигурации grub.
- Конфигурационный файл **Grub** обычно лежит по пути */boot/grub/grub.conf*
- Функция **GRUB** состоит в том, чтобы найти и загрузить ядро ​​Linux в оперативную память и передать управление компьютером ядру.\
- Если быть кратким, GRUB просто напросто загружает и выполняет образы ядра и **initrd**.

4) **Kernel** (ядро)
- Ядро монтирует файловую систему в соответствии с настройкой «root=» в файле grub.conf
- Выполняет программу /sbin/init
- **initrd** — это *Initial RAM Disk*, он же временный диск в оперативной памяти
Так как файловые системы еще не смонтированы, ядро при запуске использует временную файловую систему из файла **initrd.img**, для того чтобы загрузиться полностью. После извлечения оно загружает инициализацию операционной системы - **Systemd** (PID 1) и передает ей управление.

5)**Systemd** 
**Systemd** является основным родителем для всех процессов, имеет первый номер процесса (PID 1) и отвечает за доведение хоста Linux до состояния, в котором можно выполнять работу.
**Systemd** монтирует файловые системы, как определено в файле */etc/fstab*, включая любые файлы подкачки или разделы. На этом этапе он уже может получить доступ к файлам конфигурации, расположенным в */etc*, включая свои конфигурационные файлы.
Он использует свой файл конфигурации, чтобы определить, в каком состоянии должен загрузить [[Host|хост]]. 
### Загрузка linux с UEFI

Новые компьютеры используют **UEFI** (Unified Extensible Firmware Interface) вместо **BIOS**. UEFI содержит множество преимуществ перед **BIOS**, одна из которых - поддержка **GPT**, который позволяет использовать большие диски и помещать загрузчик на специальный раздел, а также позволяет создавать много разделов.

**GPT** (GUID partition table)  отвечает за создание и организацию разделов на жестких дисках. В отличие от **MBR** интерфейс прошивки **GPT** поддерживает **UEFI** с быстрой загрузкой, большей емкостью разделов и большим количеством разделов. 
У **MBR** есть ограничение - диск не мог быть больше 2 TB, а разделов не могло быть больше четырёх.
Диск разбитый с помощью GPT в первом секторе продолжает хранить MBR запись, для того, чтобы старые системы с BIOS могли использовать диски с таблицей разделов GPT.